var main = {
  init: function(){
    $('.fn-refresh').click(main.posts.refresh).click().click();
  },
  loading: {
    popup: function(){
      $.mobile.loading( 'show' );
      setTimeout( function(){ $.mobile.loading('hide'); }, 5000);
    }
  },
  posts: {
    refresh: function(){
      main.posts.list();
    },
    list: function(){
      var data = [
        { image: 'http://images.hamshahrionline.ir/images/position36/2013/10/musighe-920709-as.jpg', title: 'ادعاهای نتانیاهو در مجمع عمومی سازمان ملل درباره ایران' }, 
        { image: 'http://images.hamshahrionline.ir/images/position36/2013/10/obama.jpg', title: 'شهردار تهران در اردوی استقلال حاضر شد/ مدیرعامل سابق پرسپولیس هم به هتل المپیک رفت' },
        { image: 'http://images.hamshahrionline.ir/images/position36/2013/10/netanyaho.jpg', title: 'خروج از رکود تورمی؛ چگونه؟' } 
      ];
      var list = $('.template .fn-post').template( data, { appendTo: '.fn-posts' } );
      main.posts.actions(list);
    },
    actions: function(list){
    /*  $(list).swipe({
        swipe:function(event, direction, distance, duration, fingerCount) {
          $(this).animate({ left: -$(window).outerWidth() }, function(){ $(this).slideUp() } );
        }
      });*/
      main.drag.init(list);
      $('.fn-more', list).click( main.posts.more );
      $('.fn-like', list).click( main.posts.like );
      $('.fn-dislike', list).click( main.posts.dislike );
    },
    more: function(){
      $(this).parents('.fn-post').find('.fn-description').slideToggle();
      $(this).parents('.fn-post').toggleClass('expanded');
    },
    like: function(){
      $(this).parents('.fn-post').addClass('liked');
    },
    dislike: function(){
      $(this).parents('.fn-post').removeClass('liked');
    }
  },
  drag: {
    init: function(target){
      $(target).on({
        mousedown: function(e){
          $(window).data({ down:true, oX: (e.offsetX||0), oY: (e.offsetY||0), el:this }).on('mousemove', main.drag.move);
        },
        mouseup: function(){
          $(window).data('down', false).off('mousemove', main.drag.move);
        }
      })
    },
    move: function(e){
      var data=$(window).data();
      if(data.down){
        $(data.el).css({
          left: e.clientX - data.oX,
          top: e.clientY - data.oY
        });
      }
    }
  }
};
